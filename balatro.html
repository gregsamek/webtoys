<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clonatro</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            overflow-x: hidden;
        }

        .game-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header */
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 25px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            margin-bottom: 20px;
            border: 2px solid #e94560;
            box-shadow: 0 0 20px rgba(233, 69, 96, 0.3);
        }

        .logo {
            font-size: 2em;
            font-weight: bold;
            background: linear-gradient(45deg, #e94560, #ff6b9d);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
        }

        .stats {
            display: flex;
            gap: 30px;
        }

        .stat {
            text-align: center;
        }

        .stat-label {
            font-size: 0.8em;
            color: #888;
            text-transform: uppercase;
        }

        .stat-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
        }

        .stat-value.money {
            color: #4ade80;
        }

        /* Main game area */
        .game-area {
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
        }

        /* Joker area */
        .joker-panel {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 15px;
            border: 2px solid #4a4a6a;
        }

        .panel-title {
            font-size: 1em;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .joker-slots {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .joker-card {
            background: linear-gradient(135deg, #2a2a4a 0%, #1a1a3a 100%);
            border-radius: 10px;
            padding: 10px;
            border: 2px solid #6a6a8a;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }

        .joker-card:hover {
            border-color: #e94560;
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(233, 69, 96, 0.3);
        }

        .joker-card.empty {
            border-style: dashed;
            opacity: 0.5;
            min-height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
        }

        .joker-name {
            font-weight: bold;
            font-size: 0.9em;
            color: #ffd700;
        }

        .joker-desc {
            font-size: 0.7em;
            color: #aaa;
            margin-top: 5px;
        }

        .joker-rarity {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .joker-rarity.common { background: #888; }
        .joker-rarity.uncommon { background: #4ade80; }
        .joker-rarity.rare { background: #60a5fa; }
        .joker-rarity.legendary { background: #f472b6; }

        /* Main play area */
        .play-area {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* Blind info */
        .blind-info {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 2px solid #4a4a6a;
        }

        .blind-details {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .blind-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
        }

        .blind-icon.small { background: linear-gradient(135deg, #4a9eff, #2563eb); }
        .blind-icon.big { background: linear-gradient(135deg, #f97316, #dc2626); }
        .blind-icon.boss { background: linear-gradient(135deg, #a855f7, #7c3aed); }

        .blind-text h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }

        .blind-text p {
            color: #888;
            font-size: 0.9em;
        }

        .score-display {
            text-align: right;
        }

        .current-score {
            font-size: 2em;
            font-weight: bold;
            color: #4ade80;
        }

        .target-score {
            font-size: 1em;
            color: #888;
        }

        .target-score span {
            color: #e94560;
            font-weight: bold;
        }

        /* Scoring preview */
        .scoring-preview {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            border: 2px solid #3a3a5a;
        }

        .hand-name {
            font-size: 1.5em;
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 10px;
        }

        .score-calc {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            font-size: 1.3em;
        }

        .chips {
            color: #60a5fa;
            font-weight: bold;
        }

        .mult {
            color: #e94560;
            font-weight: bold;
        }

        .score-result {
            color: #4ade80;
            font-weight: bold;
            font-size: 1.2em;
        }

        /* Cards area */
        .cards-section {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 15px;
            padding: 25px;
            border: 2px solid #3a3a5a;
        }

        .selected-cards {
            min-height: 140px;
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 10px;
            border: 2px dashed #4a4a6a;
        }

        .selected-cards.has-cards {
            border-style: solid;
            border-color: #e94560;
        }

        .hand-cards {
            display: flex;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        /* Playing cards */
        .card {
            width: 80px;
            height: 112px;
            background: linear-gradient(135deg, #fff 0%, #f0f0f0 100%);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            padding: 8px;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
            user-select: none;
        }

        .card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
        }

        .card.selected {
            transform: translateY(-20px);
            box-shadow: 0 15px 30px rgba(233, 69, 96, 0.5);
            border: 3px solid #e94560;
        }

        .card.scoring {
            animation: scoreGlow 0.5s ease-in-out;
        }

        @keyframes scoreGlow {
            0%, 100% { box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3); }
            50% { box-shadow: 0 0 30px rgba(255, 215, 0, 0.8); }
        }

        .card.in-play {
            transform: translateY(-15px);
        }

        .card-corner {
            display: flex;
            flex-direction: column;
            align-items: center;
            line-height: 1;
        }

        .card-corner.bottom {
            align-self: flex-end;
            transform: rotate(180deg);
        }

        .card-rank {
            font-size: 1.2em;
            font-weight: bold;
        }

        .card-suit {
            font-size: 1em;
        }

        .card.hearts .card-rank,
        .card.hearts .card-suit,
        .card.diamonds .card-rank,
        .card.diamonds .card-suit {
            color: #e94560;
        }

        .card.spades .card-rank,
        .card.spades .card-suit,
        .card.clubs .card-rank,
        .card.clubs .card-suit {
            color: #1a1a2e;
        }

        .card-center {
            font-size: 2em;
            text-align: center;
        }

        .card-enhancement {
            position: absolute;
            top: -5px;
            right: -5px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            font-size: 0.7em;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .card-enhancement.bonus { background: #4ade80; }
        .card-enhancement.mult { background: #e94560; }
        .card-enhancement.wild { background: #a855f7; }

        /* Action buttons */
        .actions {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .btn {
            padding: 15px 40px;
            font-size: 1.1em;
            font-weight: bold;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-play {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #000;
        }

        .btn-play:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(74, 222, 128, 0.4);
        }

        .btn-discard {
            background: linear-gradient(135deg, #f97316, #dc2626);
            color: #fff;
        }

        .btn-discard:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(220, 38, 38, 0.4);
        }

        .btn-sort {
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            color: #fff;
            padding: 10px 20px;
            font-size: 0.9em;
        }

        .btn-sort:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.4);
        }

        .action-info {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-top: 15px;
        }

        .action-counter {
            text-align: center;
        }

        .action-counter .label {
            font-size: 0.8em;
            color: #888;
            text-transform: uppercase;
        }

        .action-counter .value {
            font-size: 1.5em;
            font-weight: bold;
        }

        .action-counter .value.hands { color: #4ade80; }
        .action-counter .value.discards { color: #f97316; }

        /* Shop */
        .shop-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .shop-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .shop-container {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 90%;
            border: 3px solid #e94560;
            box-shadow: 0 0 50px rgba(233, 69, 96, 0.3);
        }

        .shop-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .shop-title {
            font-size: 2em;
            color: #ffd700;
        }

        .shop-money {
            font-size: 1.5em;
            color: #4ade80;
        }

        .shop-section {
            margin-bottom: 25px;
        }

        .shop-section-title {
            font-size: 1.2em;
            color: #888;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .shop-items {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .shop-item {
            background: rgba(0, 0, 0, 0.4);
            border-radius: 15px;
            padding: 15px;
            width: 150px;
            text-align: center;
            border: 2px solid #4a4a6a;
            cursor: pointer;
            transition: all 0.3s;
        }

        .shop-item:hover:not(.sold) {
            border-color: #ffd700;
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(255, 215, 0, 0.2);
        }

        .shop-item.sold {
            opacity: 0.3;
            cursor: not-allowed;
        }

        .shop-item-icon {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .shop-item-name {
            font-weight: bold;
            color: #ffd700;
            margin-bottom: 5px;
        }

        .shop-item-desc {
            font-size: 0.8em;
            color: #aaa;
            margin-bottom: 10px;
            min-height: 40px;
        }

        .shop-item-price {
            background: #4ade80;
            color: #000;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }

        .shop-item.sold .shop-item-price {
            background: #666;
            color: #999;
        }

        .btn-continue {
            background: linear-gradient(135deg, #a855f7, #7c3aed);
            color: #fff;
            width: 100%;
            padding: 20px;
            font-size: 1.3em;
        }

        .btn-continue:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(168, 85, 247, 0.4);
        }

        /* Game over / Win screen */
        .game-over-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .game-over-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .game-over-content {
            text-align: center;
        }

        .game-over-title {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .game-over-title.win {
            color: #ffd700;
            text-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
        }

        .game-over-title.lose {
            color: #e94560;
            text-shadow: 0 0 30px rgba(233, 69, 96, 0.5);
        }

        .game-over-stats {
            font-size: 1.5em;
            color: #888;
            margin-bottom: 30px;
        }

        .btn-restart {
            background: linear-gradient(135deg, #4ade80, #22c55e);
            color: #000;
            padding: 20px 60px;
            font-size: 1.3em;
        }

        /* Score animation */
        .score-popup {
            position: fixed;
            pointer-events: none;
            font-size: 2em;
            font-weight: bold;
            color: #ffd700;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
            animation: scoreFloat 1s ease-out forwards;
            z-index: 100;
        }

        @keyframes scoreFloat {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-100px); opacity: 0; }
        }

        /* Round transition */
        .round-transition {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 500;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .round-transition.active {
            opacity: 1;
            visibility: visible;
        }

        .round-transition-content {
            text-align: center;
            animation: pulseIn 0.5s ease-out;
        }

        @keyframes pulseIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .round-transition h2 {
            font-size: 3em;
            color: #4ade80;
            margin-bottom: 10px;
        }

        .round-transition p {
            font-size: 1.5em;
            color: #888;
        }

        /* Hand types reference */
        .hand-reference {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 10px;
            padding: 15px;
            border: 2px solid #4a4a6a;
            max-width: 250px;
            font-size: 0.8em;
            z-index: 50;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .hand-reference.visible {
            opacity: 1;
            visibility: visible;
        }

        .hand-reference h4 {
            color: #ffd700;
            margin-bottom: 10px;
        }

        .hand-reference-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
            border-bottom: 1px solid #333;
        }

        .hand-reference-item:last-child {
            border-bottom: none;
        }

        .btn-help {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: #4a4a6a;
            color: #fff;
            border: none;
            cursor: pointer;
            font-size: 1.2em;
            z-index: 51;
        }

        .btn-help:hover {
            background: #6a6a8a;
        }

        /* Responsive */
        @media (max-width: 900px) {
            .game-area {
                grid-template-columns: 1fr;
            }

            .joker-panel {
                order: -1;
            }

            .joker-slots {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
            }

            .joker-card {
                width: 120px;
            }

            .card {
                width: 60px;
                height: 84px;
                padding: 5px;
            }

            .card-rank {
                font-size: 1em;
            }

            .card-suit {
                font-size: 0.8em;
            }

            .card-center {
                font-size: 1.5em;
            }
        }

        /* Deck display */
        .deck-info {
            text-align: center;
            padding: 10px;
            color: #888;
            font-size: 0.9em;
        }

        /* Level up effect */
        .level-up {
            animation: levelUp 0.5s ease-out;
        }

        @keyframes levelUp {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); color: #ffd700; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <header class="header">
            <div class="logo">üÉè CLONATRO</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-label">Round</div>
                    <div class="stat-value" id="round">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Ante</div>
                    <div class="stat-value" id="ante">1</div>
                </div>
                <div class="stat">
                    <div class="stat-label">Money</div>
                    <div class="stat-value money" id="money">$4</div>
                </div>
            </div>
        </header>

        <div class="game-area">
            <aside class="joker-panel">
                <div class="panel-title">Jokers</div>
                <div class="joker-slots" id="jokerSlots">
                    <div class="joker-card empty">Empty</div>
                    <div class="joker-card empty">Empty</div>
                    <div class="joker-card empty">Empty</div>
                    <div class="joker-card empty">Empty</div>
                    <div class="joker-card empty">Empty</div>
                </div>
            </aside>

            <main class="play-area">
                <div class="blind-info">
                    <div class="blind-details">
                        <div class="blind-icon small" id="blindIcon">üëÅÔ∏è</div>
                        <div class="blind-text">
                            <h3 id="blindName">Small Blind</h3>
                            <p id="blindDesc">Score at least the target to win</p>
                        </div>
                    </div>
                    <div class="score-display">
                        <div class="current-score" id="currentScore">0</div>
                        <div class="target-score">Target: <span id="targetScore">300</span></div>
                    </div>
                </div>

                <div class="scoring-preview" id="scoringPreview">
                    <div class="hand-name" id="handName">Select cards to play</div>
                    <div class="score-calc" id="scoreCalc" style="display: none;">
                        <span class="chips" id="previewChips">0</span>
                        <span>√ó</span>
                        <span class="mult" id="previewMult">0</span>
                        <span>=</span>
                        <span class="score-result" id="previewTotal">0</span>
                    </div>
                </div>

                <div class="cards-section">
                    <div class="selected-cards" id="selectedCards">
                        <span style="color: #666; align-self: center;">Selected cards appear here</span>
                    </div>

                    <div class="hand-cards" id="handCards"></div>

                    <div class="actions">
                        <button class="btn btn-play" id="playBtn" disabled>Play Hand</button>
                        <button class="btn btn-discard" id="discardBtn" disabled>Discard</button>
                        <button class="btn btn-sort" id="sortBtn">Sort</button>
                    </div>

                    <div class="action-info">
                        <div class="action-counter">
                            <div class="label">Hands</div>
                            <div class="value hands" id="handsLeft">4</div>
                        </div>
                        <div class="action-counter">
                            <div class="label">Discards</div>
                            <div class="value discards" id="discardsLeft">3</div>
                        </div>
                    </div>

                    <div class="deck-info">
                        Cards in deck: <span id="deckCount">52</span>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Shop Overlay -->
    <div class="shop-overlay" id="shopOverlay">
        <div class="shop-container">
            <div class="shop-header">
                <h2 class="shop-title">üè™ SHOP</h2>
                <div class="shop-money">$<span id="shopMoney">4</span></div>
            </div>

            <div class="shop-section">
                <h3 class="shop-section-title">Jokers</h3>
                <div class="shop-items" id="shopJokers"></div>
            </div>

            <div class="shop-section">
                <h3 class="shop-section-title">Boosters & Items</h3>
                <div class="shop-items" id="shopItems"></div>
            </div>

            <button class="btn btn-continue" id="continueBtn">Continue to Next Round</button>
        </div>
    </div>

    <!-- Game Over Overlay -->
    <div class="game-over-overlay" id="gameOverOverlay">
        <div class="game-over-content">
            <h1 class="game-over-title" id="gameOverTitle">GAME OVER</h1>
            <p class="game-over-stats" id="gameOverStats">You reached Round 1</p>
            <button class="btn btn-restart" id="restartBtn">Play Again</button>
        </div>
    </div>

    <!-- Round Transition -->
    <div class="round-transition" id="roundTransition">
        <div class="round-transition-content">
            <h2 id="transitionTitle">Round Complete!</h2>
            <p id="transitionSubtitle">+$4 earned</p>
        </div>
    </div>

    <!-- Help Button & Reference -->
    <button class="btn-help" id="helpBtn">?</button>
    <div class="hand-reference" id="handReference">
        <h4>Poker Hands</h4>
        <div class="hand-reference-item"><span>Royal Flush</span><span>100√ó8</span></div>
        <div class="hand-reference-item"><span>Straight Flush</span><span>100√ó8</span></div>
        <div class="hand-reference-item"><span>Four of a Kind</span><span>60√ó7</span></div>
        <div class="hand-reference-item"><span>Full House</span><span>40√ó4</span></div>
        <div class="hand-reference-item"><span>Flush</span><span>35√ó4</span></div>
        <div class="hand-reference-item"><span>Straight</span><span>30√ó4</span></div>
        <div class="hand-reference-item"><span>Three of a Kind</span><span>30√ó3</span></div>
        <div class="hand-reference-item"><span>Two Pair</span><span>20√ó2</span></div>
        <div class="hand-reference-item"><span>Pair</span><span>10√ó2</span></div>
        <div class="hand-reference-item"><span>High Card</span><span>5√ó1</span></div>
    </div>

    <script>
        // Game Constants
        const SUITS = ['hearts', 'diamonds', 'clubs', 'spades'];
        const SUIT_SYMBOLS = { hearts: '‚ô•', diamonds: '‚ô¶', clubs: '‚ô£', spades: '‚ô†' };
        const RANKS = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
        const RANK_VALUES = { '2': 2, '3': 3, '4': 4, '5': 5, '6': 6, '7': 7, '8': 8, '9': 9, '10': 10, 'J': 10, 'Q': 10, 'K': 10, 'A': 11 };

        // Hand Types with base chips and mult
        const HAND_TYPES = {
            'Royal Flush': { chips: 100, mult: 8, level: 1 },
            'Straight Flush': { chips: 100, mult: 8, level: 1 },
            'Four of a Kind': { chips: 60, mult: 7, level: 1 },
            'Full House': { chips: 40, mult: 4, level: 1 },
            'Flush': { chips: 35, mult: 4, level: 1 },
            'Straight': { chips: 30, mult: 4, level: 1 },
            'Three of a Kind': { chips: 30, mult: 3, level: 1 },
            'Two Pair': { chips: 20, mult: 2, level: 1 },
            'Pair': { chips: 10, mult: 2, level: 1 },
            'High Card': { chips: 5, mult: 1, level: 1 }
        };

        // Joker definitions
        const JOKER_TYPES = [
            { id: 'joker', name: 'Joker', desc: '+4 Mult', rarity: 'common', effect: { mult: 4 }, price: 4 },
            { id: 'greedy', name: 'Greedy Joker', desc: '+3 Mult per ‚ô¶ in hand', rarity: 'common', effect: { multPerSuit: { suit: 'diamonds', mult: 3 } }, price: 5 },
            { id: 'lusty', name: 'Lusty Joker', desc: '+3 Mult per ‚ô• in hand', rarity: 'common', effect: { multPerSuit: { suit: 'hearts', mult: 3 } }, price: 5 },
            { id: 'wrathful', name: 'Wrathful Joker', desc: '+3 Mult per ‚ô† in hand', rarity: 'common', effect: { multPerSuit: { suit: 'spades', mult: 3 } }, price: 5 },
            { id: 'gluttonous', name: 'Gluttonous Joker', desc: '+3 Mult per ‚ô£ in hand', rarity: 'common', effect: { multPerSuit: { suit: 'clubs', mult: 3 } }, price: 5 },
            { id: 'halfjoker', name: 'Half Joker', desc: '+20 Mult if hand ‚â§3 cards', rarity: 'common', effect: { multIfHandSize: { max: 3, mult: 20 } }, price: 5 },
            { id: 'banner', name: 'Banner', desc: '+30 Chips per discard left', rarity: 'common', effect: { chipsPerDiscard: 30 }, price: 5 },
            { id: 'mystic', name: 'Mystic Summit', desc: '+15 Mult if 0 discards left', rarity: 'common', effect: { multIfNoDiscards: 15 }, price: 5 },
            { id: 'fibonacci', name: 'Fibonacci', desc: '+8 Mult if hand has Ace, 2, 3, 5, or 8', rarity: 'uncommon', effect: { multForFibonacci: 8 }, price: 7 },
            { id: 'scholar', name: 'Scholar', desc: '+20 Chips and +4 Mult per Ace', rarity: 'uncommon', effect: { perAce: { chips: 20, mult: 4 } }, price: 7 },
            { id: 'evenSteven', name: 'Even Steven', desc: '+4 Mult per even card', rarity: 'common', effect: { multPerEven: 4 }, price: 4 },
            { id: 'oddTodd', name: 'Odd Todd', desc: '+30 Chips per odd card', rarity: 'common', effect: { chipsPerOdd: 30 }, price: 4 },
            { id: 'scary', name: 'Scary Face', desc: '+30 Chips per face card', rarity: 'common', effect: { chipsPerFace: 30 }, price: 4 },
            { id: 'abstract', name: 'Abstract Joker', desc: '+3 Mult per Joker owned', rarity: 'uncommon', effect: { multPerJoker: 3 }, price: 6 },
            { id: 'steel', name: 'Steel Joker', desc: 'x1.5 Mult', rarity: 'uncommon', effect: { xMult: 1.5 }, price: 7 },
            { id: 'baron', name: 'Baron', desc: 'x1.5 Mult per King in hand', rarity: 'rare', effect: { xMultPerKing: 1.5 }, price: 9 },
            { id: 'blueprint', name: 'Blueprint', desc: 'Copies ability of Joker to the right', rarity: 'rare', effect: { copyRight: true }, price: 10 },
            { id: 'theDuo', name: 'The Duo', desc: 'x2 Mult if hand has a Pair', rarity: 'rare', effect: { xMultIfPair: 2 }, price: 8 },
            { id: 'theTrio', name: 'The Trio', desc: 'x3 Mult if hand has Three of a Kind', rarity: 'rare', effect: { xMultIfThree: 3 }, price: 8 },
            { id: 'theFamily', name: 'The Family', desc: 'x4 Mult if hand has Four of a Kind', rarity: 'rare', effect: { xMultIfFour: 4 }, price: 8 },
            { id: 'blackboard', name: 'Blackboard', desc: 'x3 Mult if all cards in hand are ‚ô† or ‚ô£', rarity: 'uncommon', effect: { xMultIfBlack: 3 }, price: 7 },
            { id: 'hiker', name: 'Hiker', desc: '+4 Chips to each played card permanently', rarity: 'uncommon', effect: { permChipsOnPlay: 4 }, price: 6 },
        ];

        // Game State
        let gameState = {
            deck: [],
            hand: [],
            selectedCards: [],
            money: 4,
            ante: 1,
            round: 1,
            roundInAnte: 1,  // 1 = small, 2 = big, 3 = boss
            score: 0,
            targetScore: 300,
            handsLeft: 4,
            discardsLeft: 3,
            jokers: [],
            handLevels: JSON.parse(JSON.stringify(HAND_TYPES)),
            sortByRank: true,
            cardEnhancements: {} // card id -> enhancement
        };

        // DOM Elements
        const elements = {
            handCards: document.getElementById('handCards'),
            selectedCards: document.getElementById('selectedCards'),
            playBtn: document.getElementById('playBtn'),
            discardBtn: document.getElementById('discardBtn'),
            sortBtn: document.getElementById('sortBtn'),
            handsLeft: document.getElementById('handsLeft'),
            discardsLeft: document.getElementById('discardsLeft'),
            currentScore: document.getElementById('currentScore'),
            targetScore: document.getElementById('targetScore'),
            round: document.getElementById('round'),
            ante: document.getElementById('ante'),
            money: document.getElementById('money'),
            handName: document.getElementById('handName'),
            scoreCalc: document.getElementById('scoreCalc'),
            previewChips: document.getElementById('previewChips'),
            previewMult: document.getElementById('previewMult'),
            previewTotal: document.getElementById('previewTotal'),
            scoringPreview: document.getElementById('scoringPreview'),
            blindIcon: document.getElementById('blindIcon'),
            blindName: document.getElementById('blindName'),
            blindDesc: document.getElementById('blindDesc'),
            deckCount: document.getElementById('deckCount'),
            jokerSlots: document.getElementById('jokerSlots'),
            shopOverlay: document.getElementById('shopOverlay'),
            shopJokers: document.getElementById('shopJokers'),
            shopItems: document.getElementById('shopItems'),
            shopMoney: document.getElementById('shopMoney'),
            continueBtn: document.getElementById('continueBtn'),
            gameOverOverlay: document.getElementById('gameOverOverlay'),
            gameOverTitle: document.getElementById('gameOverTitle'),
            gameOverStats: document.getElementById('gameOverStats'),
            restartBtn: document.getElementById('restartBtn'),
            roundTransition: document.getElementById('roundTransition'),
            transitionTitle: document.getElementById('transitionTitle'),
            transitionSubtitle: document.getElementById('transitionSubtitle'),
            helpBtn: document.getElementById('helpBtn'),
            handReference: document.getElementById('handReference')
        };

        // Initialize Game
        function initGame() {
            gameState = {
                deck: [],
                hand: [],
                selectedCards: [],
                money: 4,
                ante: 1,
                round: 1,
                roundInAnte: 1,
                score: 0,
                targetScore: 300,
                handsLeft: 4,
                discardsLeft: 3,
                jokers: [],
                handLevels: JSON.parse(JSON.stringify(HAND_TYPES)),
                sortByRank: true,
                cardEnhancements: {}
            };

            createDeck();
            shuffleDeck();
            dealHand();
            updateUI();
            hideOverlays();
        }

        // Create a standard 52-card deck
        function createDeck() {
            gameState.deck = [];
            let id = 0;
            for (const suit of SUITS) {
                for (const rank of RANKS) {
                    gameState.deck.push({
                        id: id++,
                        suit,
                        rank,
                        value: RANK_VALUES[rank],
                        bonusChips: 0
                    });
                }
            }
        }

        // Shuffle deck
        function shuffleDeck() {
            for (let i = gameState.deck.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [gameState.deck[i], gameState.deck[j]] = [gameState.deck[j], gameState.deck[i]];
            }
        }

        // Deal hand
        function dealHand() {
            const cardsToDeal = 8 - gameState.hand.length;
            for (let i = 0; i < cardsToDeal && gameState.deck.length > 0; i++) {
                gameState.hand.push(gameState.deck.pop());
            }
            gameState.selectedCards = [];
            sortHand();
        }

        // Sort hand
        function sortHand() {
            if (gameState.sortByRank) {
                gameState.hand.sort((a, b) => RANKS.indexOf(b.rank) - RANKS.indexOf(a.rank));
            } else {
                gameState.hand.sort((a, b) => {
                    const suitDiff = SUITS.indexOf(a.suit) - SUITS.indexOf(b.suit);
                    if (suitDiff !== 0) return suitDiff;
                    return RANKS.indexOf(b.rank) - RANKS.indexOf(a.rank);
                });
            }
        }

        // Create card element
        function createCardElement(card, inHand = true) {
            const div = document.createElement('div');
            div.className = `card ${card.suit}`;
            div.dataset.id = card.id;

            if (gameState.selectedCards.find(c => c.id === card.id)) {
                div.classList.add('selected');
            }

            const enhancement = gameState.cardEnhancements[card.id];
            let enhancementHTML = '';
            if (enhancement) {
                enhancementHTML = `<div class="card-enhancement ${enhancement}">${enhancement === 'bonus' ? '+' : enhancement === 'mult' ? '√ó' : '‚òÖ'}</div>`;
            }

            div.innerHTML = `
                <div class="card-corner">
                    <span class="card-rank">${card.rank}</span>
                    <span class="card-suit">${SUIT_SYMBOLS[card.suit]}</span>
                </div>
                <div class="card-center">${SUIT_SYMBOLS[card.suit]}</div>
                <div class="card-corner bottom">
                    <span class="card-rank">${card.rank}</span>
                    <span class="card-suit">${SUIT_SYMBOLS[card.suit]}</span>
                </div>
                ${enhancementHTML}
            `;

            if (inHand) {
                div.addEventListener('click', () => toggleCardSelection(card));
            }

            return div;
        }

        // Toggle card selection
        function toggleCardSelection(card) {
            const index = gameState.selectedCards.findIndex(c => c.id === card.id);
            if (index > -1) {
                gameState.selectedCards.splice(index, 1);
            } else if (gameState.selectedCards.length < 5) {
                gameState.selectedCards.push(card);
            }
            updateUI();
            updateScoringPreview();
        }

        // Evaluate poker hand
        function evaluateHand(cards) {
            if (cards.length === 0) return null;

            const ranks = cards.map(c => c.rank);
            const suits = cards.map(c => c.suit);
            const rankCounts = {};
            ranks.forEach(r => rankCounts[r] = (rankCounts[r] || 0) + 1);

            const counts = Object.values(rankCounts).sort((a, b) => b - a);
            const uniqueRanks = Object.keys(rankCounts);

            const isFlush = cards.length >= 5 && new Set(suits).size === 1;

            // Check for straight
            const rankIndices = uniqueRanks.map(r => RANKS.indexOf(r)).sort((a, b) => a - b);
            let isStraight = false;
            if (cards.length >= 5 && uniqueRanks.length >= 5) {
                // Check normal straight
                for (let i = 0; i <= rankIndices.length - 5; i++) {
                    if (rankIndices[i + 4] - rankIndices[i] === 4) {
                        isStraight = true;
                        break;
                    }
                }
                // Check ace-low straight (A-2-3-4-5)
                if (!isStraight && rankIndices.includes(12) && rankIndices.includes(0) && 
                    rankIndices.includes(1) && rankIndices.includes(2) && rankIndices.includes(3)) {
                    isStraight = true;
                }
            }

            // Check for royal flush
            const isRoyal = isFlush && isStraight && ranks.includes('A') && ranks.includes('K');

            // Determine hand type
            if (isRoyal) return { type: 'Royal Flush', scoringCards: cards };
            if (isFlush && isStraight) return { type: 'Straight Flush', scoringCards: cards };
            if (counts[0] === 4) {
                const quadRank = Object.keys(rankCounts).find(r => rankCounts[r] === 4);
                return { type: 'Four of a Kind', scoringCards: cards.filter(c => c.rank === quadRank) };
            }
            if (counts[0] === 3 && counts[1] >= 2) {
                const tripRank = Object.keys(rankCounts).find(r => rankCounts[r] === 3);
                const pairRank = Object.keys(rankCounts).find(r => rankCounts[r] >= 2 && r !== tripRank);
                return { type: 'Full House', scoringCards: cards.filter(c => c.rank === tripRank || c.rank === pairRank) };
            }
            if (isFlush) return { type: 'Flush', scoringCards: cards };
            if (isStraight) return { type: 'Straight', scoringCards: cards };
            if (counts[0] === 3) {
                const tripRank = Object.keys(rankCounts).find(r => rankCounts[r] === 3);
                return { type: 'Three of a Kind', scoringCards: cards.filter(c => c.rank === tripRank) };
            }
            if (counts[0] === 2 && counts[1] === 2) {
                const pairRanks = Object.keys(rankCounts).filter(r => rankCounts[r] === 2);
                return { type: 'Two Pair', scoringCards: cards.filter(c => pairRanks.includes(c.rank)) };
            }
            if (counts[0] === 2) {
                const pairRank = Object.keys(rankCounts).find(r => rankCounts[r] === 2);
                return { type: 'Pair', scoringCards: cards.filter(c => c.rank === pairRank) };
            }

            // High card - highest card scores
            const highCard = cards.reduce((high, card) => 
                RANKS.indexOf(card.rank) > RANKS.indexOf(high.rank) ? card : high
            );
            return { type: 'High Card', scoringCards: [highCard] };
        }

        // Calculate score
        function calculateScore(cards, preview = false) {
            const evaluation = evaluateHand(cards);
            if (!evaluation) return { chips: 0, mult: 0, total: 0, handType: 'None' };

            const handData = gameState.handLevels[evaluation.type];
            let chips = handData.chips;
            let mult = handData.mult;

            // Add card values to chips for scoring cards
            evaluation.scoringCards.forEach(card => {
                chips += card.value;
                chips += card.bonusChips || 0;

                // Card enhancements
                const enhancement = gameState.cardEnhancements[card.id];
                if (enhancement === 'bonus') chips += 30;
                if (enhancement === 'mult') mult += 4;
            });

            // Apply joker effects
            let xMult = 1;

            gameState.jokers.forEach((joker, jokerIndex) => {
                const effect = joker.effect;

                // Check for Blueprint copying
                if (effect.copyRight && jokerIndex < gameState.jokers.length - 1) {
                    const nextJoker = gameState.jokers[jokerIndex + 1];
                    if (nextJoker) {
                        // Apply the next joker's effect
                        applyJokerEffect(nextJoker.effect, cards, evaluation, { chips: () => chips, mult: () => mult, xMult: () => xMult }, 
                            (c) => chips = c, (m) => mult = m, (x) => xMult = x);
                    }
                    return;
                }

                applyJokerEffect(effect, cards, evaluation, { chips: () => chips, mult: () => mult, xMult: () => xMult }, 
                    (c) => chips = c, (m) => mult = m, (x) => xMult = x);
            });

            // Apply xMult
            mult *= xMult;

            const total = Math.floor(chips * mult);

            return {
                chips,
                mult,
                total,
                handType: evaluation.type,
                scoringCards: evaluation.scoringCards
            };
        }

        function applyJokerEffect(effect, cards, evaluation, getters, setChips, setMult, setXMult) {
            let chips = getters.chips();
            let mult = getters.mult();
            let xMult = getters.xMult();

            if (effect.mult) mult += effect.mult;
            if (effect.chips) chips += effect.chips;

            if (effect.multPerSuit) {
                const count = cards.filter(c => c.suit === effect.multPerSuit.suit).length;
                mult += count * effect.multPerSuit.mult;
            }

            if (effect.multIfHandSize && cards.length <= effect.multIfHandSize.max) {
                mult += effect.multIfHandSize.mult;
            }

            if (effect.chipsPerDiscard) {
                chips += gameState.discardsLeft * effect.chipsPerDiscard;
            }

            if (effect.multIfNoDiscards && gameState.discardsLeft === 0) {
                mult += effect.multIfNoDiscards;
            }

            if (effect.multForFibonacci) {
                const fibRanks = ['A', '2', '3', '5', '8'];
                const hasFib = cards.some(c => fibRanks.includes(c.rank));
                if (hasFib) mult += effect.multForFibonacci;
            }

            if (effect.perAce) {
                const aceCount = evaluation.scoringCards.filter(c => c.rank === 'A').length;
                chips += aceCount * effect.perAce.chips;
                mult += aceCount * effect.perAce.mult;
            }

            if (effect.multPerEven) {
                const evenRanks = ['2', '4', '6', '8', '10'];
                const count = evaluation.scoringCards.filter(c => evenRanks.includes(c.rank)).length;
                mult += count * effect.multPerEven;
            }

            if (effect.chipsPerOdd) {
                const oddRanks = ['A', '3', '5', '7', '9'];
                const count = evaluation.scoringCards.filter(c => oddRanks.includes(c.rank)).length;
                chips += count * effect.chipsPerOdd;
            }

            if (effect.chipsPerFace) {
                const faceRanks = ['J', 'Q', 'K'];
                const count = evaluation.scoringCards.filter(c => faceRanks.includes(c.rank)).length;
                chips += count * effect.chipsPerFace;
            }

            if (effect.multPerJoker) {
                mult += gameState.jokers.length * effect.multPerJoker;
            }

            if (effect.xMult) {
                xMult *= effect.xMult;
            }

            if (effect.xMultPerKing) {
                const kingCount = cards.filter(c => c.rank === 'K').length;
                for (let i = 0; i < kingCount; i++) {
                    xMult *= effect.xMultPerKing;
                }
            }

            if (effect.xMultIfPair && evaluation.type === 'Pair') {
                xMult *= effect.xMultIfPair;
            }

            if (effect.xMultIfThree && evaluation.type === 'Three of a Kind') {
                xMult *= effect.xMultIfThree;
            }

            if (effect.xMultIfFour && evaluation.type === 'Four of a Kind') {
                xMult *= effect.xMultIfFour;
            }

            if (effect.xMultIfBlack) {
                const allBlack = cards.every(c => c.suit === 'spades' || c.suit === 'clubs');
                if (allBlack && cards.length > 0) {
                    xMult *= effect.xMultIfBlack;
                }
            }

            setChips(chips);
            setMult(mult);
            setXMult(xMult);
        }

        // Update scoring preview
        function updateScoringPreview() {
            if (gameState.selectedCards.length === 0) {
                elements.handName.textContent = 'Select cards to play';
                elements.scoreCalc.style.display = 'none';
                return;
            }

            const score = calculateScore(gameState.selectedCards, true);
            elements.handName.textContent = score.handType;
            elements.previewChips.textContent = Math.floor(score.chips);
            elements.previewMult.textContent = score.mult.toFixed(1);
            elements.previewTotal.textContent = score.total;
            elements.scoreCalc.style.display = 'flex';
        }

        // Play hand
        async function playHand() {
            if (gameState.selectedCards.length === 0 || gameState.handsLeft === 0) return;

            const score = calculateScore(gameState.selectedCards);
            gameState.handsLeft--;

            // Apply Hiker effect
            const hiker = gameState.jokers.find(j => j.effect.permChipsOnPlay);
            if (hiker) {
                gameState.selectedCards.forEach(card => {
                    card.bonusChips = (card.bonusChips || 0) + hiker.effect.permChipsOnPlay;
                });
            }

            // Animate scoring
            await animateScoring(score);

            // Remove played cards from hand
            gameState.hand = gameState.hand.filter(c => !gameState.selectedCards.find(s => s.id === c.id));
            gameState.selectedCards = [];

            // Level up the hand type
            gameState.handLevels[score.handType].level++;
            gameState.handLevels[score.handType].chips += 10;
            gameState.handLevels[score.handType].mult += 1;

            // Check win/lose conditions
            if (gameState.score >= gameState.targetScore) {
                await showRoundWin();
            } else if (gameState.handsLeft === 0) {
                showGameOver(false);
            } else {
                dealHand();
                updateUI();
            }
        }

        // Animate scoring
        async function animateScoring(score) {
            // Show cards being played
            score.scoringCards.forEach(card => {
                const cardEl = document.querySelector(`.card[data-id="${card.id}"]`);
                if (cardEl) {
                    cardEl.classList.add('scoring');
                }
            });

            await sleep(300);

            // Animate score increasing
            const startScore = gameState.score;
            const endScore = gameState.score + score.total;
            const duration = 500;
            const startTime = Date.now();

            return new Promise(resolve => {
                function animate() {
                    const elapsed = Date.now() - startTime;
                    const progress = Math.min(elapsed / duration, 1);

                    gameState.score = Math.floor(startScore + (endScore - startScore) * progress);
                    elements.currentScore.textContent = gameState.score.toLocaleString();

                    if (progress < 1) {
                        requestAnimationFrame(animate);
                    } else {
                        // Show score popup
                        showScorePopup(score.total);
                        resolve();
                    }
                }
                animate();
            });
        }

        // Show score popup
        function showScorePopup(score) {
            const popup = document.createElement('div');
            popup.className = 'score-popup';
            popup.textContent = `+${score.toLocaleString()}`;
            popup.style.left = '50%';
            popup.style.top = '40%';
            popup.style.transform = 'translateX(-50%)';
            document.body.appendChild(popup);

            setTimeout(() => popup.remove(), 1000);
        }

        // Discard cards
        function discardCards() {
            if (gameState.selectedCards.length === 0 || gameState.discardsLeft === 0) return;

            gameState.discardsLeft--;
            gameState.hand = gameState.hand.filter(c => !gameState.selectedCards.find(s => s.id === c.id));
            gameState.selectedCards = [];

            dealHand();
            updateUI();
        }

        // Show round win
        async function showRoundWin() {
            const earnings = calculateEarnings();
            gameState.money += earnings;

            elements.transitionTitle.textContent = 'Round Complete!';
            elements.transitionSubtitle.textContent = `+$${earnings} earned`;
            elements.roundTransition.classList.add('active');

            await sleep(1500);
            elements.roundTransition.classList.remove('active');

            await sleep(300);
            showShop();
        }

        // Calculate earnings
        function calculateEarnings() {
            let earnings = 4; // Base
            earnings += gameState.handsLeft; // Bonus for remaining hands
            return earnings;
        }

        // Show shop
        function showShop() {
            elements.shopMoney.textContent = gameState.money;

            // Generate shop items
            generateShopItems();

            elements.shopOverlay.classList.add('active');
        }

        // Generate shop items
        function generateShopItems() {
            elements.shopJokers.innerHTML = '';
            elements.shopItems.innerHTML = '';

            // Add 2-3 random jokers
            const availableJokers = JOKER_TYPES.filter(j => !gameState.jokers.find(gj => gj.id === j.id));
            const shuffledJokers = [...availableJokers].sort(() => Math.random() - 0.5);
            const shopJokers = shuffledJokers.slice(0, Math.min(3, shuffledJokers.length));

            shopJokers.forEach(joker => {
                const item = createShopJokerElement(joker);
                elements.shopJokers.appendChild(item);
            });

            // Add items
            const items = [
                { id: 'planet', name: 'Planet Card', desc: 'Level up a random poker hand', icon: 'ü™ê', price: 3 },
                { id: 'tarot', name: 'Tarot Card', desc: 'Enhance a random card in deck', icon: 'üîÆ', price: 3 }
            ];

            items.forEach(item => {
                const el = createShopItemElement(item);
                elements.shopItems.appendChild(el);
            });
        }

        // Create shop joker element
        function createShopJokerElement(joker) {
            const div = document.createElement('div');
            div.className = 'shop-item';
            div.innerHTML = `
                <div class="shop-item-icon">üÉè</div>
                <div class="shop-item-name">${joker.name}</div>
                <div class="shop-item-desc">${joker.desc}</div>
                <div class="shop-item-price">$${joker.price}</div>
            `;

            div.addEventListener('click', () => buyJoker(joker, div));
            return div;
        }

        // Create shop item element
        function createShopItemElement(item) {
            const div = document.createElement('div');
            div.className = 'shop-item';
            div.innerHTML = `
                <div class="shop-item-icon">${item.icon}</div>
                <div class="shop-item-name">${item.name}</div>
                <div class="shop-item-desc">${item.desc}</div>
                <div class="shop-item-price">$${item.price}</div>
            `;

            div.addEventListener('click', () => buyItem(item, div));
            return div;
        }

        // Buy joker
        function buyJoker(joker, element) {
            if (gameState.money < joker.price || gameState.jokers.length >= 5) return;
            if (element.classList.contains('sold')) return;

            gameState.money -= joker.price;
            gameState.jokers.push({ ...joker });

            element.classList.add('sold');
            elements.shopMoney.textContent = gameState.money;
            updateJokerDisplay();
        }

        // Buy item
        function buyItem(item, element) {
            if (gameState.money < item.price) return;
            if (element.classList.contains('sold')) return;

            gameState.money -= item.price;
            element.classList.add('sold');
            elements.shopMoney.textContent = gameState.money;

            if (item.id === 'planet') {
                // Level up random hand
                const handTypes = Object.keys(gameState.handLevels);
                const randomHand = handTypes[Math.floor(Math.random() * handTypes.length)];
                gameState.handLevels[randomHand].level++;
                gameState.handLevels[randomHand].chips += 20;
                gameState.handLevels[randomHand].mult += 2;
            } else if (item.id === 'tarot') {
                // Enhance random card
                const allCards = [...gameState.deck, ...gameState.hand];
                if (allCards.length > 0) {
                    const randomCard = allCards[Math.floor(Math.random() * allCards.length)];
                    const enhancements = ['bonus', 'mult', 'wild'];
                    gameState.cardEnhancements[randomCard.id] = enhancements[Math.floor(Math.random() * enhancements.length)];
                }
            }
        }

        // Continue to next round
        function continueToNextRound() {
            elements.shopOverlay.classList.remove('active');

            gameState.roundInAnte++;

            if (gameState.roundInAnte > 3) {
                gameState.roundInAnte = 1;
                gameState.ante++;

                if (gameState.ante > 8) {
                    showGameOver(true);
                    return;
                }
            }

            gameState.round++;
            gameState.score = 0;
            gameState.handsLeft = 4;
            gameState.discardsLeft = 3;

            // Calculate new target
            const baseScores = { 1: 300, 2: 450, 3: 600 };
            const anteMultiplier = Math.pow(1.5, gameState.ante - 1);
            gameState.targetScore = Math.floor(baseScores[gameState.roundInAnte] * anteMultiplier);

            // Reset and reshuffle deck
            createDeck();
            // Re-apply card enhancements
            gameState.deck.forEach(card => {
                if (gameState.cardEnhancements[card.id]) {
                    // Enhancement persists
                }
            });
            shuffleDeck();
            gameState.hand = [];
            dealHand();

            updateUI();
        }

        // Show game over
        function showGameOver(won) {
            elements.gameOverTitle.textContent = won ? 'üéâ YOU WIN! üéâ' : 'GAME OVER';
            elements.gameOverTitle.className = `game-over-title ${won ? 'win' : 'lose'}`;
            elements.gameOverStats.textContent = `You reached Ante ${gameState.ante}, Round ${gameState.round}`;
            elements.gameOverOverlay.classList.add('active');
        }

        // Update joker display
        function updateJokerDisplay() {
            elements.jokerSlots.innerHTML = '';

            for (let i = 0; i < 5; i++) {
                if (i < gameState.jokers.length) {
                    const joker = gameState.jokers[i];
                    const div = document.createElement('div');
                    div.className = 'joker-card';
                    div.innerHTML = `
                        <div class="joker-rarity ${joker.rarity}"></div>
                        <div class="joker-name">${joker.name}</div>
                        <div class="joker-desc">${joker.desc}</div>
                    `;
                    div.title = joker.desc;
                    elements.jokerSlots.appendChild(div);
                } else {
                    const div = document.createElement('div');
                    div.className = 'joker-card empty';
                    div.textContent = 'Empty';
                    elements.jokerSlots.appendChild(div);
                }
            }
        }

        // Update UI
        function updateUI() {
            // Update hand cards
            elements.handCards.innerHTML = '';
            gameState.hand.forEach(card => {
                elements.handCards.appendChild(createCardElement(card));
            });

            // Update selected cards display
            elements.selectedCards.innerHTML = '';
            if (gameState.selectedCards.length === 0) {
                elements.selectedCards.innerHTML = '<span style="color: #666; align-self: center;">Selected cards appear here</span>';
                elements.selectedCards.classList.remove('has-cards');
            } else {
                elements.selectedCards.classList.add('has-cards');
                gameState.selectedCards.forEach(card => {
                    const cardEl = createCardElement(card, false);
                    cardEl.classList.add('in-play');
                    elements.selectedCards.appendChild(cardEl);
                });
            }

            // Update counters
            elements.handsLeft.textContent = gameState.handsLeft;
            elements.discardsLeft.textContent = gameState.discardsLeft;
            elements.currentScore.textContent = gameState.score.toLocaleString();
            elements.targetScore.textContent = gameState.targetScore.toLocaleString();
            elements.round.textContent = gameState.round;
            elements.ante.textContent = gameState.ante;
            elements.money.textContent = `$${gameState.money}`;
            elements.deckCount.textContent = gameState.deck.length;

            // Update blind display
            const blindTypes = {
                1: { name: 'Small Blind', icon: 'üëÅÔ∏è', class: 'small' },
                2: { name: 'Big Blind', icon: 'üëÅÔ∏è‚Äçüó®Ô∏è', class: 'big' },
                3: { name: 'Boss Blind', icon: 'üíÄ', class: 'boss' }
            };
            const blind = blindTypes[gameState.roundInAnte];
            elements.blindName.textContent = blind.name;
            elements.blindIcon.textContent = blind.icon;
            elements.blindIcon.className = `blind-icon ${blind.class}`;

            // Update buttons
            elements.playBtn.disabled = gameState.selectedCards.length === 0 || gameState.handsLeft === 0;
            elements.discardBtn.disabled = gameState.selectedCards.length === 0 || gameState.discardsLeft === 0;

            // Update joker display
            updateJokerDisplay();

            // Update scoring preview
            updateScoringPreview();
        }

        // Hide overlays
        function hideOverlays() {
            elements.shopOverlay.classList.remove('active');
            elements.gameOverOverlay.classList.remove('active');
            elements.roundTransition.classList.remove('active');
        }

        // Utility sleep function
        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Event Listeners
        elements.playBtn.addEventListener('click', playHand);
        elements.discardBtn.addEventListener('click', discardCards);
        elements.sortBtn.addEventListener('click', () => {
            gameState.sortByRank = !gameState.sortByRank;
            sortHand();
            updateUI();
        });
        elements.continueBtn.addEventListener('click', continueToNextRound);
        elements.restartBtn.addEventListener('click', initGame);

        elements.helpBtn.addEventListener('click', () => {
            elements.handReference.classList.toggle('visible');
        });

        // Start game
        initGame();
    </script>
</body>
</html>